USE [Sap_Approval]
GO
/****** Object:  StoredProcedure [dbo].[GetServiceDetails]    Script Date: 16-06-2025 14:11:50 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

ALTER PROCEDURE [dbo].[GetServiceDetails]
@UserID Varchar(50)
AS
BEGIN
         SELECT 
        i.Inward_ID,
        
        v.Vendor_Code,
        v.Vendor_Name,
        p.Plant_Code,
     --- CONVERT(VARCHAR(10), i.Invoice_Date, 120) AS Invoice_Date, 
 FORMAT(i.Invoice_Date, 'dd-MM-yyyy') AS Invoice_Date, -- formatted date
        i.Invoice_No,
        i.Invoice_Value,
        i.Purchase_Order,
        i.Reason_For_Delay,
        CASE 
        WHEN i.Inward_Type = 'S' THEN 'Service'
        WHEN i.Inward_Type = 'D' THEN 'Purchase'
        ELSE i.Inward_Type
    END AS Inward_Type,
        i.Status,i.Approval1_Status,i.Approval2_Status,i.Approval3_Status,i.Approver_1,i.Approver_2,i.Approver_3,i.Approver1_Comment,i.Approver2_Comment,i.Approver3_Comment
    
    FROM 
        Trn_Inward_Old_Invoice i
    INNER JOIN 
        Mst_Vendor v ON i.Vendor_ID = v.Vendor_ID
    INNER JOIN 
        Mst_User u ON i.Created_By = u.User_ID
		 INNER JOIN
   Mst_Plant  p
    ON 
       i.Plant_ID =p.Plant_ID


	   where Inward_Type='S'And i.Created_By=@UserID 
       AND i.Status !='Approved'
      
    
    
END;
