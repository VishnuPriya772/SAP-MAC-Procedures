CREATE PROCEDURE GetApprovalforInward
AS
BEGIN
    SET NOCOUNT ON;

    SELECT *
    FROM Trn_Inward_Old_Invoice
    WHERE 
        (
            -- For 'D' type: Approver1 must be role 7, Approver2 role 10 or 6
            Inward_Type = 'D'
            AND Approver_1 = '7'
            AND (Approver_2 = '10' OR Approver_2 = '6')
            AND (
                Approval1_Status = 'Waiting for First Approval'
                OR (Approval1_Status = 'Approved' AND Approval2_Status = 'Waiting for Second Approval')
                OR (Approval2_Status = 'Approved')
            )
        )
        OR
        (
            -- For 'S' type: Approver1 = 3, Approver2 = 7, Approver3 = 6
            Inward_Type = 'S'
            AND Approver_1 = '3'
            AND Approver_2 = '7'
            AND Approver_3 = '6'
            AND (
                Approval1_Status = 'Waiting for First Approval'
                OR (Approval1_Status = 'Approved' AND Approval2_Status = 'Waiting for Second Approval')
                OR (Approval2_Status = 'Approved' AND Approval3_Status = 'Waiting for Final Approval')
                OR (Approval3_Status = 'Approved')
            )
        );
END;
